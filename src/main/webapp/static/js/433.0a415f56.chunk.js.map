{"version":3,"file":"static/js/433.0a415f56.chunk.js","mappings":"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","sources":["pages/Apply/DepartmentChange/index.tsx"],"sourcesContent":["import {\r\n    Input,\r\n    Modal,\r\n    Button,\r\n    Form,\r\n    message,\r\n    Result,\r\n    Select,\r\n    Typography,\r\n    Upload\r\n} from 'antd';\r\nimport type {UploadProps} from 'antd/es/upload/interface';\r\nimport {InboxOutlined} from '@ant-design/icons';\r\nimport React, {useEffect, useState} from 'react';\r\nimport {useNavigate} from 'react-router-dom';\r\nimport {\r\n    deleteFile,\r\n    queryDepartmentMessage,\r\n    teacherChangeDepartment,\r\n    checkTeacherChangeDepartment,\r\n    checkLastTimeUploadFiles\r\n} from \"../../../component/axios/api\";\r\nimport './index.scss';\r\nimport Cookie from \"js-cookie\";\r\nimport {BaseURL} from \"../../../component/axios/baseURL\";\r\n\r\nconst {Title} = Typography;\r\nconst apiToken = Cookie.get('token');\r\n\r\nconst URL = `${BaseURL}/api`;\r\n\r\nconst LeaveForm = () => {\r\n    const navigate = useNavigate();\r\n    // 防止反复查询变更记录\r\n    const [isQuery, setIsQuery] = useState<boolean>(false);\r\n    const [waitTime, setWaitTime] = useState<number>(9);\r\n    // 文件上传列表\r\n    const [fileList, setFileList] = useState<any>([]);\r\n    // 确认框状态\r\n    const [confirmLoading, setConfirmLoading] = useState<boolean>(false);\r\n    const [isModalVisible, setIsModalVisible] = useState<boolean>(false);\r\n    // 展示表单还是提示信息\r\n    const [isRenderResult, setIsRenderResult] = useState<boolean>(true);\r\n    const [RenderResultTitle, setRenderResultTitle] = useState<String>('正在获取部门变更申请记录');\r\n    // 部门列表\r\n    const [departmentOptions, setDepartmentOptions] = useState([]);\r\n    // 监听表单数据\r\n    const [form] = Form.useForm();\r\n    const departmentUid = Form.useWatch('departmentUid', form);\r\n    const changeReason = Form.useWatch('changeReason', form);\r\n\r\n    useEffect(() => {\r\n        checkDepartmentChange();\r\n    }, [])\r\n\r\n    useEffect(() => {\r\n        const timer = setTimeout(() => {\r\n            if (waitTime > 1) {\r\n                setIsQuery(true)\r\n                setWaitTime(e => e - 1)\r\n                setIsQuery(true)\r\n            } else {\r\n                setIsQuery(false)\r\n            }\r\n        }, 1000)\r\n        return () => {\r\n            clearTimeout(timer)\r\n        }\r\n    }, [waitTime])\r\n\r\n    // 查询是否有正在审批的部门变更申请\r\n    const checkDepartmentChange = () => {\r\n        setIsQuery(true)\r\n        setWaitTime(10)\r\n        // 防止多次点击\r\n        if (isQuery) {\r\n            return\r\n        }\r\n        checkTeacherChangeDepartment().then(res => {\r\n            if (res.code === 200) {\r\n                setIsRenderResult(false)\r\n                checkUploadFilesList();\r\n            } else {\r\n                message.warning(res.msg);\r\n                setRenderResultTitle(\"您已经提交过部门变更申请，请等待审批结果\")\r\n            }\r\n        })\r\n    }\r\n\r\n    // 查询上次上传的文件列表\r\n    const checkUploadFilesList = () => {\r\n        checkLastTimeUploadFiles('changedepartmentbyteacher').then(res => {\r\n            if (res.code === 200) {\r\n                console.log(res)\r\n                // 遍历 res.body\r\n                const fileList = res.body.map((item: any) => {\r\n                    return {\r\n                        uid: item.fileName,\r\n                        name: item.oldFileName,\r\n                        status: 'done',\r\n                        url: `${URL}/downloadFile?filename=${item.fileName}`,\r\n                    }\r\n                })\r\n                setFileList(fileList)\r\n            }\r\n        })\r\n    }\r\n\r\n    // 文件上传\r\n    const props: UploadProps = {\r\n        name: 'file',\r\n        headers: {\r\n            'Authorization': `${apiToken}`,\r\n            'tableUid': 'changedepartmentbyteacher'\r\n        },\r\n        multiple: true,\r\n        action: `${URL}/uploadFile`,\r\n        // action: 'https://www.allynlin.site:8080/cshbxy/api/uploadFile',\r\n        fileList: fileList,\r\n        // 如果上传的文件大于 20M，就提示错误\r\n        beforeUpload: (file: any) => {\r\n            if (file.size / 1024 / 1024 > 20) {\r\n                message.warning('文件大小不能超过 20M');\r\n                // 将对应文件的状态设置为 error\r\n                file.status = 'error';\r\n                return false;\r\n            }\r\n            return true;\r\n        },\r\n        onChange(info) {\r\n            const {status} = info.file;\r\n            setFileList([...info.fileList]);\r\n            if (status !== 'uploading') {\r\n                console.log(info.file, info.fileList);\r\n            }\r\n            if (status === 'done') {\r\n                if (info.file.response.code === 200) {\r\n                    message.success(info.file.response.msg);\r\n                    // 找到对应的文件，将它的 uid 修改为 response.body\r\n                    const newFileList = fileList.map((item: any) => {\r\n                        if (item.uid === info.file.uid) {\r\n                            item.url = `${URL}/downloadFile?filename=${info.file.response.body}`;\r\n                            item.status = 'done';\r\n                            item.uid = info.file.response.body;\r\n                        }\r\n                        return item;\r\n                    })\r\n                    setFileList(newFileList);\r\n                } else {\r\n                    message.error(info.file.response.msg);\r\n                }\r\n            } else if (status === 'error') {\r\n                message.error(`${info.file.name} 文件上传失败`);\r\n            }\r\n        },\r\n        onDrop(e: any) {\r\n            console.log('Dropped files', e.dataTransfer.files);\r\n        },\r\n        onRemove(info: any) {\r\n            const status = info.status;\r\n            if (status === 'done') {\r\n                // 获取需要删除的文件的 uid\r\n                const uid = info.uid;\r\n                deleteFile(uid).then(res => {\r\n                    message.success(res.msg);\r\n                })\r\n            }\r\n        },\r\n        progress: {\r\n            strokeColor: {\r\n                '0%': '#108ee9',\r\n                '100%': '#87d068',\r\n            },\r\n            strokeWidth: 3,\r\n            format: percent => percent && `${parseFloat(percent.toFixed(2))}%`,\r\n        },\r\n    };\r\n\r\n    // 表单提交\r\n    const submitForm = () => {\r\n        teacherChangeDepartment(departmentUid, changeReason).then(res => {\r\n            setConfirmLoading(false);\r\n            message.success(res.msg);\r\n            navigate('/home');\r\n        }).catch(err => {\r\n            setConfirmLoading(false);\r\n        })\r\n    }\r\n\r\n    // 获取部门列表\r\n    const getDepartmentOptions = () => {\r\n        queryDepartmentMessage().then(res => {\r\n            const departmentOptions = res.body.map((item: { uid: String; realeName: String; }) => {\r\n                return {\r\n                    value: item.uid,\r\n                    label: item.realeName\r\n                }\r\n            })\r\n            setDepartmentOptions(departmentOptions);\r\n        })\r\n    }\r\n\r\n    const RenderModal: React.FC = () => {\r\n        return (\r\n            <Modal\r\n                title=\"Title\"\r\n                open={isModalVisible}\r\n                onOk={handleOk}\r\n                confirmLoading={confirmLoading}\r\n                onCancel={handleCancel}\r\n            >\r\n                <p>变更部门：{departmentUid}</p>\r\n                <p>变更原因：{changeReason}</p>\r\n                {/*将变更材料 changeFile 中的 fileList 数组中的状态为 done 的每一项 name 输出出来*/}\r\n                <p>变更材料：{\r\n                    fileList.filter((item: any) => item.status === 'done').map((item: any) => item.name).join('、')\r\n                }</p>\r\n            </Modal>\r\n        )\r\n    }\r\n\r\n    const handleCancel = () => {\r\n        setIsModalVisible(false);\r\n    };\r\n\r\n    const handleOk = () => {\r\n        setConfirmLoading(true);\r\n        submitForm();\r\n    };\r\n\r\n    const onFinish = (values: any) => {\r\n        setIsModalVisible(true)\r\n    };\r\n\r\n    const onReset = () => {\r\n        form.resetFields();\r\n    };\r\n\r\n    return isRenderResult ? (\r\n        <Result\r\n            status=\"warning\"\r\n            title={RenderResultTitle}\r\n            extra={\r\n                <>\r\n                    <Button type=\"primary\" key=\"console\" onClick={() => {\r\n                        navigate('/record/leaveList', {replace: true})\r\n                    }}>\r\n                        查看部门变更申请记录\r\n                    </Button>\r\n                    <Button type={'primary'} key=\"buy\"\r\n                            onClick={() => {\r\n                                checkDepartmentChange();\r\n                            }}\r\n                            disabled={isQuery}\r\n                    >\r\n                        {isQuery ? `请等待${waitTime}秒后可以刷新` : '刷新'}\r\n                    </Button>\r\n                </>\r\n            }\r\n        />) : (\r\n        <div className={'body'}>\r\n            <RenderModal/>\r\n            <div className=\"zent-alert-example\">\r\n                <Title level={2} className={'tit'}>部门变更申请</Title>\r\n                <Form\r\n                    form={form}\r\n                    name=\"basic\"\r\n                    labelCol={{span: 8}}\r\n                    wrapperCol={{span: 16}}\r\n                    onFinish={onFinish}\r\n                >\r\n                    <Form.Item\r\n                        label=\"变更部门\"\r\n                        name=\"departmentUid\"\r\n                        rules={[{required: true, message: '请选择你需要变更的新部门'}]}\r\n                    >\r\n                        <Select\r\n                            showSearch\r\n                            placeholder=\"请选择你需要变更的新部门\"\r\n                            optionFilterProp=\"children\"\r\n                            onFocus={getDepartmentOptions}\r\n                            options={departmentOptions}\r\n                        />\r\n                    </Form.Item>\r\n\r\n                    <Form.Item\r\n                        label=\"变更原因\"\r\n                        name=\"changeReason\"\r\n                        rules={[{required: true, message: '请输入变更原因'}]}\r\n                    >\r\n                        <Input.TextArea rows={4} placeholder={\"请输入变更原因\"}/>\r\n                    </Form.Item>\r\n\r\n                    <Form.Item\r\n                        label=\"变更材料\"\r\n                        name=\"file\"\r\n                        rules={[{required: false, message: '请上传变更材料'}]}\r\n                    >\r\n                        <Upload.Dragger {...props}>\r\n                            <p className=\"ant-upload-drag-icon\">\r\n                                <InboxOutlined/>\r\n                            </p>\r\n                            <p className=\"ant-upload-text\">单击或拖动文件到此区域进行上传</p>\r\n                            <p className=\"ant-upload-hint\">\r\n                                支持单个或批量上传（单文件不超过 20M）\r\n                            </p>\r\n                        </Upload.Dragger>\r\n                    </Form.Item>\r\n\r\n                    <Form.Item wrapperCol={{offset: 8, span: 16}}>\r\n                        <Button type=\"primary\" htmlType=\"submit\">\r\n                            提交\r\n                        </Button>\r\n                        <Button htmlType=\"button\" onClick={onReset} style={{marginLeft: 8}}>\r\n                            重置\r\n                        </Button>\r\n                    </Form.Item>\r\n                </Form>\r\n            </div>\r\n        </div>\r\n    )\r\n        ;\r\n};\r\n\r\nconst Index = () => {\r\n    return (\r\n        <LeaveForm/>\r\n    )\r\n}\r\n\r\nexport default Index;"],"names":["Title","Typography","apiToken","Cookie","URL","BaseURL","LeaveForm","navigate","useNavigate","useState","isQuery","setIsQuery","waitTime","setWaitTime","fileList","setFileList","confirmLoading","setConfirmLoading","isModalVisible","setIsModalVisible","isRenderResult","setIsRenderResult","RenderResultTitle","setRenderResultTitle","departmentOptions","setDepartmentOptions","Form","form","departmentUid","changeReason","useEffect","checkDepartmentChange","timer","setTimeout","e","clearTimeout","checkTeacherChangeDepartment","then","res","code","checkUploadFilesList","message","msg","checkLastTimeUploadFiles","console","log","body","map","item","uid","fileName","name","oldFileName","status","url","props","headers","multiple","action","beforeUpload","file","size","onChange","info","response","newFileList","onDrop","dataTransfer","files","onRemove","deleteFile","progress","strokeColor","strokeWidth","format","percent","parseFloat","toFixed","RenderModal","title","open","onOk","handleOk","onCancel","handleCancel","filter","join","teacherChangeDepartment","catch","err","extra","type","onClick","replace","disabled","className","level","labelCol","span","wrapperCol","onFinish","values","label","rules","required","showSearch","placeholder","optionFilterProp","onFocus","queryDepartmentMessage","value","realeName","options","rows","InboxOutlined","offset","htmlType","resetFields","style","marginLeft"],"sourceRoot":""}